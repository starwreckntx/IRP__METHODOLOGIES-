{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://irp.framework/schemas/consensus-session.json",
  "title": "Consensus Session",
  "description": "Schema for AI consensus protocol sessions",
  "type": "object",
  "properties": {
    "session_id": {
      "type": "string",
      "pattern": "^CONS-[0-9]{14}-[a-f0-9]{6}$",
      "description": "Unique session identifier"
    },
    "topic": {
      "type": "string",
      "minLength": 10,
      "description": "The decision topic"
    },
    "category": {
      "type": "string",
      "enum": ["operational", "strategic", "constitutional", "emergency"],
      "description": "Decision category determining requirements"
    },
    "voting_system": {
      "type": "string",
      "enum": ["unanimous", "supermajority", "simple_majority", "weighted", "ranked_choice"],
      "description": "Voting system to use"
    },
    "participants": {
      "type": "array",
      "minItems": 2,
      "items": {
        "$ref": "#/definitions/participant"
      }
    },
    "phases": {
      "type": "array",
      "items": {
        "$ref": "#/definitions/phase"
      }
    },
    "positions": {
      "type": "array",
      "items": {
        "$ref": "#/definitions/position"
      }
    },
    "votes": {
      "type": "array",
      "items": {
        "$ref": "#/definitions/vote"
      }
    },
    "status": {
      "type": "string",
      "enum": ["initiated", "proposal", "deliberation", "voting", "achieved", "near_consensus", "deadlock", "escalated"],
      "description": "Current session status"
    },
    "decision": {
      "type": ["string", "null"],
      "description": "Final decision if reached"
    },
    "dissent": {
      "type": "array",
      "items": {
        "type": "object",
        "properties": {
          "model_id": {"type": "string"},
          "position": {"type": "string"},
          "reasoning": {"type": "string"}
        }
      },
      "description": "Recorded minority positions"
    },
    "created_at": {
      "type": "string",
      "format": "date-time"
    },
    "completed_at": {
      "type": ["string", "null"],
      "format": "date-time"
    }
  },
  "required": ["session_id", "topic", "category", "voting_system", "participants"],
  "definitions": {
    "participant": {
      "type": "object",
      "properties": {
        "model_id": {"type": "string"},
        "provider": {"type": "string"},
        "expertise_weight": {"type": "number", "minimum": 0, "maximum": 2},
        "trust_level": {"type": "integer", "minimum": 0, "maximum": 4}
      },
      "required": ["model_id", "provider"]
    },
    "phase": {
      "type": "object",
      "properties": {
        "name": {"type": "string", "enum": ["proposal", "deliberation", "voting", "ratification"]},
        "duration": {"type": "string", "pattern": "^PT[0-9]+[MHS]$"},
        "started_at": {"type": "string", "format": "date-time"},
        "completed_at": {"type": ["string", "null"], "format": "date-time"}
      }
    },
    "position": {
      "type": "object",
      "properties": {
        "model_id": {"type": "string"},
        "recommendation": {"type": "string"},
        "confidence": {"type": "number", "minimum": 0, "maximum": 1},
        "reasoning": {"type": "string"},
        "evidence": {"type": "array", "items": {"type": "string"}},
        "concerns": {"type": "array", "items": {"type": "string"}},
        "alternatives": {"type": "array", "items": {"type": "string"}},
        "timestamp": {"type": "string", "format": "date-time"}
      },
      "required": ["model_id", "recommendation", "confidence"]
    },
    "vote": {
      "type": "object",
      "properties": {
        "model_id": {"type": "string"},
        "choice": {"type": "string"},
        "weight": {"type": "number", "minimum": 0},
        "conditions": {"type": "array", "items": {"type": "string"}},
        "timestamp": {"type": "string", "format": "date-time"}
      },
      "required": ["model_id", "choice"]
    }
  }
}
